import{J as e,K as a,_ as l,I as t,a$ as n,aV as o,a8 as s,v as i,r,x as d,B as u,Y as c,aC as v,u as m,V as p,W as g,a5 as h,Z as _,a2 as f,a0 as b,X as y,a4 as x,a7 as w,U as C,aX as L,aY as A,an as k,aZ as j}from"./entry.7629be39.js";import{l as M}from"./lodash.ea4d81e6.js";import"./AppHeader.173021d7.js";import"./AppAnimate.vue_vue_type_script_setup_true_lang.eec04da4.js";import"./shop.55f105a8.js";import"./element-plus.bf29918d.js";import"./plus.fce3a396.js";import"./vuedraggable.12f20fb9.js";import"./sortablejs.8210fcbe.js";import"./index.3eac53c1.js";import"./FixMenu.vue_vue_type_style_index_0_scoped_5afae692_lang.c67f782d.js";/* empty css                                                                  *//* empty css                                                                  */const I={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},z=[l("path",{fill:"currentColor",d:"M176 416a112 112 0 1 0 0 224a112 112 0 0 0 0-224m0 64a48 48 0 1 1 0 96a48 48 0 0 1 0-96zm336-64a112 112 0 1 1 0 224a112 112 0 0 1 0-224zm0 64a48 48 0 1 0 0 96a48 48 0 0 0 0-96zm336-64a112 112 0 1 1 0 224a112 112 0 0 1 0-224zm0 64a48 48 0 1 0 0 96a48 48 0 0 0 0-96z"},null,-1)];const H={name:"ep-more",render:function(l,t){return e(),a("svg",I,z)}},$={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},E=[l("path",{fill:"currentColor",d:"m512 747.84l228.16 119.936a6.4 6.4 0 0 0 9.28-6.72l-43.52-254.08l184.512-179.904a6.4 6.4 0 0 0-3.52-10.88l-255.104-37.12L517.76 147.904a6.4 6.4 0 0 0-11.52 0L392.192 379.072l-255.104 37.12a6.4 6.4 0 0 0-3.52 10.88L318.08 606.976l-43.584 254.08a6.4 6.4 0 0 0 9.28 6.72L512 747.84zM313.6 924.48a70.4 70.4 0 0 1-102.144-74.24l37.888-220.928L88.96 472.96A70.4 70.4 0 0 1 128 352.896l221.76-32.256l99.2-200.96a70.4 70.4 0 0 1 126.208 0l99.2 200.96l221.824 32.256a70.4 70.4 0 0 1 39.04 120.064L774.72 629.376l37.888 220.928a70.4 70.4 0 0 1-102.144 74.24L512 820.096l-198.4 104.32z"},null,-1)];const N={name:"ep-star",render:function(l,t){return e(),a("svg",$,E)}},B={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},T=[l("path",{fill:"currentColor",d:"m795.904 750.72l124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704a352 352 0 0 0 0 704z"},null,-1)];const W={name:"ep-search",render:function(l,t){return e(),a("svg",B,T)}},q=e=>(L("data-v-b2df7680"),e=e(),A(),e),F={class:"water-fall"},S={class:"image-con"},V={class:"image-list"},X=["onMouseenter"],Y=["date-src","alt"],Z={key:0,class:"item-wrapper"},J={class:"icon-con"},K={key:0},O={class:"text-con"},R={class:"spinner"},U=[q((()=>l("div",{class:"dot1"},null,-1))),q((()=>l("div",{class:"dot2"},null,-1)))],D=j(t({__name:"index",props:["datas","flur","loading","searchText"],emits:["load","preview","favorite"],setup(t,{emit:L}){const A=t,{$store:j}=n(),I=o(),z=s({images:[],imagesLen:0,beginIndex:0,loadedCount:0,colsHeightArr:[],columnNumber:5});i((()=>A.datas),(e=>{console.log("val :>> ",e),"pc-home"===I.name&&(e&&e.length>0?(e.length<=50&&(z.beginIndex=0,z.loadedCount=0),z.images=e,z.imagesLen=e.length,ne()):(z.images=[],z.imagesLen=0,z.beginIndex=0,z.loadedCount=0,z.colsHeightArr=[],G.value=1,P.value=50))}));const $=r([]),E=r(0),B=r(0),T=r(null),q=r(window.document.body),D=r(null),G=r(1),P=r(50),Q=r(""),ee=r([]),ae=()=>{D.value=null},le=()=>{let e,a,l;0===z.beginIndex&&(z.colsHeightArr=[]);for(let t=z.beginIndex;t<z.imagesLen;++t){const n=z.images[t];if(!n)return;if(l=n._height||0,t<z.columnNumber)z.colsHeightArr.push(l),e=0,a=t*E.value+t%z.columnNumber;else{const t=Math.min.apply(null,z.colsHeightArr),n=z.colsHeightArr.indexOf(t);e=t,a=n*E.value,z.colsHeightArr[n]+=l}n._top=e,n._left=a}},te=()=>{console.log("预加载完毕 :>> "),le(),ee.value=z.images,C((()=>{(()=>{T.value&&(T.value.style.height=`${Math.max.apply(null,z.colsHeightArr)+340}px`);const e=k($.value);if(e){for(let a=z.beginIndex;a<z.imagesLen;++a){const l=e[a];if(!l)return;const t=l.children[0].children[0];t.src=t.getAttribute("date-src"),t.style.transition="all 0.5s ease-in-out",t.onload=()=>{t.style.opacity=1,t.style.transform="scale(1)"}}z.beginIndex=e.length}})()}))},ne=()=>{B.value=document.body.clientHeight,z.images.forEach(((e,a)=>{if(!(a<z.loadedCount))if(e.minify_preview){const a=new Image;a.src=e.minify_preview,a.onload=a.onerror=l=>{e._width=E.value,e._height="load"===l.type?Math.round(E.value*(a.height/a.width)):a.width,"error"===l.type&&(e._error=!0),z.loadedCount=z.loadedCount+1,z.imagesLen===z.loadedCount&&te()}}else e._width=E.value,e._height=E.value,z.loadedCount=z.loadedCount+1,z.imagesLen===z.loadedCount&&te()}))},oe=()=>{console.log("页面宽高变化预加载完毕 :>> "),le(),ee.value=z.images,C((()=>{(()=>{T.value&&(T.value.style.height=`${Math.max.apply(null,z.colsHeightArr)+340}px`);const e=k($.value);e&&(z.beginIndex=e.length)})()}))},se=()=>{const e=document.body.clientWidth;z.columnNumber=e>3500?10:e<3500&&e>2500?8:e<2500&&e>2e3?7:e<2e3&&e>1700?6:e<1700&&e>1380?5:e<1380&&e>1160?4:e<1160&&e>850?3:e<850&&e>600?2:1,E.value=Math.round((document.body.clientWidth-30)/z.columnNumber)},ie=M.exports.debounce((()=>{if(A.loading)return;const e=Math.min.apply(null,z.colsHeightArr);q.value.scrollTop+B.value>e-20&&(console.log("触底"),G.value=G.value+1,L("load",{pageIndex:G.value,pageSize:P.value}))}),1500),re=M.exports.debounce((()=>{se(),z.loadedCount=0,z.beginIndex=0,z.images.forEach((e=>{e.minify_preview?(e._width=E.value,e._height=Math.round(E.value*(e._height/e._width)),z.loadedCount=z.loadedCount+1,z.imagesLen===z.loadedCount&&oe()):(e._width=E.value,e._height=E.value,z.loadedCount=z.loadedCount+1,z.imagesLen===z.loadedCount&&oe())}))}),800);return d((()=>{var e;Q.value=j.get("ip"),z.images=A.datas?A.datas:[],z.imagesLen=null==(e=A.datas)?void 0:e.length,se(),ne(),q.value=document.querySelector(".home-page"),q.value.addEventListener("scroll",ie),window.addEventListener("resize",re)})),u((()=>{q.value.removeEventListener("scroll",ie),window.removeEventListener("resize",re)})),(n,o)=>{const s=W,i=N,r=H;return e(),a("div",F,[l("div",{ref_key:"wrapper",ref:T,class:"wrapper"},[l("div",S,[l("ul",V,[(e(!0),a(c,null,v(m(z).images,((n,o)=>(e(),a("li",{key:o,ref_for:!0,ref_key:"domRefs",ref:$,class:"image-item",style:h(`width:${E.value}px;height:${n._height}px;top:${n._top}px;left:${n._left}px;`)},[l("div",{class:"image-con",onMouseenter:e=>{return a=o,void(D.value=a);var a},onMouseleave:ae},[l("img",{"date-src":null==n?void 0:n.minify_preview,alt:null==n?void 0:n.prompt,class:_({"image-blur":!!t.flur})},null,10,Y),f(w,{name:"fade-q"},{default:b((()=>{var t;return[D.value===o?(e(),a("div",Z,[l("div",J,[D.value===o?(e(),a("span",K,[f(s)])):y("",!0),l("span",null,[f(i,{class:_({liked:null==(t=null==n?void 0:n.like_address)?void 0:t.includes(Q.value)}),onClick:e=>(async(e,a)=>{L("favorite",e);const l=ee.value[a].like_address,t=ee.value[a].like;ee.value[a].like_address=l?`${l},${Q.value}`:`${Q.value}`,ee.value[a].like=t+1})(null==n?void 0:n.id,o)},null,8,["class","onClick"]),f(r,{onClick:e=>{return a=n,void L("preview",{...a});var a}},null,8,["onClick"])])]),l("div",O,[l("p",null,x(null==n?void 0:n.name),1),l("p",null,x(null==n?void 0:n.prompt),1)])])):y("",!0)]})),_:2},1024)],40,X)],4)))),128))])])],512),p(l("div",R,U,512),[[g,t.loading]])])}}}),[["__scopeId","data-v-b2df7680"]]);export{D as default};
