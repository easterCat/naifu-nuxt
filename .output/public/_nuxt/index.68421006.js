import e from"./client-only.36cb5329.js";import{u as l,C as a}from"./pinia.17670579.js";import{G as n,H as o,Z as i,e as t,r as s,w as r,a as d,f as u,b as m,aa as c,$ as v,a0 as g,X as h,Y as p,J as f,L as _,a2 as b,a1 as y,W as w,u as x,ac as C,x as L,a5 as I,a6 as H,q as M}from"./element-plus.fe53e503.js";import{l as k}from"./lodash.cb875ed5.js";/* empty css                                                              */import{_ as z}from"./entry.d71b1392.js";import"./dayjs.3bf4ac2a.js";import"./store.e5acb8cd.js";const A={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},j=[i("path",{fill:"currentColor",d:"M176 416a112 112 0 1 0 0 224a112 112 0 0 0 0-224m0 64a48 48 0 1 1 0 96a48 48 0 0 1 0-96zm336-64a112 112 0 1 1 0 224a112 112 0 0 1 0-224zm0 64a48 48 0 1 0 0 96a48 48 0 0 0 0-96zm336-64a112 112 0 1 1 0 224a112 112 0 0 1 0-224zm0 64a48 48 0 1 0 0 96a48 48 0 0 0 0-96z"},null,-1)];const $={name:"ep-more",render:function(e,l){return n(),o("svg",A,j)}},E={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},N=[i("path",{fill:"currentColor",d:"m512 747.84l228.16 119.936a6.4 6.4 0 0 0 9.28-6.72l-43.52-254.08l184.512-179.904a6.4 6.4 0 0 0-3.52-10.88l-255.104-37.12L517.76 147.904a6.4 6.4 0 0 0-11.52 0L392.192 379.072l-255.104 37.12a6.4 6.4 0 0 0-3.52 10.88L318.08 606.976l-43.584 254.08a6.4 6.4 0 0 0 9.28 6.72L512 747.84zM313.6 924.48a70.4 70.4 0 0 1-102.144-74.24l37.888-220.928L88.96 472.96A70.4 70.4 0 0 1 128 352.896l221.76-32.256l99.2-200.96a70.4 70.4 0 0 1 126.208 0l99.2 200.96l221.824 32.256a70.4 70.4 0 0 1 39.04 120.064L774.72 629.376l37.888 220.928a70.4 70.4 0 0 1-102.144 74.24L512 820.096l-198.4 104.32z"},null,-1)];const S={name:"ep-star",render:function(e,l){return n(),o("svg",E,N)}},B={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},T=[i("path",{fill:"currentColor",d:"m795.904 750.72l124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704a352 352 0 0 0 0 704z"},null,-1)];const W={name:"ep-search",render:function(e,l){return n(),o("svg",B,T)}},q=e=>(I("data-v-2b877b94"),e=e(),H(),e),D={class:"water-fall"},G={class:"image-con"},J={class:"image-list"},O=["onMouseenter"],R=["src","alt"],U={key:0,class:"item-wrapper"},X={class:"icon-con"},Y={key:0},Z={class:"text-con"},F={class:"spinner"},K=[q((()=>i("div",{class:"dot1"},null,-1))),q((()=>i("div",{class:"dot2"},null,-1)))],P=z(t({__name:"index",props:["datas","flur","loading","searchText","favoriteIds"],emits:["load","preview","favorite"],setup(t,{emit:I}){const H=t,{$store:z}=l(),A=a(),j=s({images:[],imagesLen:0,beginIndex:0,loadedCount:0,colsHeightArr:[],columnNumber:5});r((()=>H.datas),(e=>{"pc-home"===A.name&&(e&&e.length>0?(e.length<=50&&(j.beginIndex=0,j.loadedCount=0),j.images=e,j.imagesLen=e.length,ie()):(j.images=[],j.imagesLen=0,j.beginIndex=0,j.loadedCount=0,j.colsHeightArr=[],Q.value=1,V.value=50))}));const E=d([]),N=d(0),B=d(0),T=d(null),q=d(window.document.body),P=d(null),Q=d(1),V=d(50),ee=d(""),le=d([]),ae=()=>{P.value=null},ne=()=>{let e,l,a;0===j.beginIndex&&(j.colsHeightArr=[]);for(let n=j.beginIndex;n<j.imagesLen;++n){const o=j.images[n];if(!o)return;if(a=o._height||0,n<j.columnNumber)j.colsHeightArr.push(a),e=0,l=n*N.value+n%j.columnNumber;else{const n=Math.min.apply(null,j.colsHeightArr);console.log("minHeight :>> ",n);const o=j.colsHeightArr.indexOf(n);e=n,l=o*N.value,j.colsHeightArr[o]+=a}o._top=e,o._left=l}},oe=()=>{console.log("预加载完毕 :>> "),ne(),le.value=j.images,L((()=>{(()=>{T.value&&(T.value.style.height=`${Math.max.apply(null,j.colsHeightArr)+340}px`);const e=M(E.value);if(e){for(let l=j.beginIndex;l<j.imagesLen;++l){const a=e[l];if(!a)return;const n=a.children[0].children[0];n.style.transition="all 0.5s ease-in-out",n.complete?setTimeout((()=>{n.style.opacity=1,n.style.transform="scale(1)"}),300):n.onload=()=>{console.log("imgEl.complete :>> ",n.complete),n.style.opacity=1,n.style.transform="scale(1)"}}j.beginIndex=e.length}})()}))},ie=()=>{B.value=document.body.clientHeight,j.images.forEach(((e,l)=>{if(!(l<j.loadedCount))if(e.minify_preview){if(e._finished)return j.loadedCount=j.loadedCount+1,void(j.imagesLen===j.loadedCount&&oe());const l=new Image;l.src=(null==e?void 0:e.min_imgbb_url)?null==e?void 0:e.min_imgbb_url:e.minify_preview,l.onload=l.onerror=a=>{e._width=N.value,e._height="load"===a.type?Math.round(N.value*(l.height/l.width)):l.width,"error"===a.type&&(e._error=!0),e._finished=!0,j.loadedCount=j.loadedCount+1,j.imagesLen===j.loadedCount&&oe()}}else e._width=N.value,e._height=N.value,j.loadedCount=j.loadedCount+1,j.imagesLen===j.loadedCount&&oe()}))},te=()=>{console.log("页面宽高变化预加载完毕 :>> "),ne(),le.value=j.images,L((()=>{(()=>{T.value&&(T.value.style.height=`${Math.max.apply(null,j.colsHeightArr)+340}px`);const e=M(E.value);e&&(j.beginIndex=e.length)})()}))},se=()=>{const e=document.body.clientWidth;j.columnNumber=e>3500?10:e<3500&&e>2800?8:e<2800&&e>2200?7:e<2200&&e>1700?6:e<1700&&e>1380?5:e<1380&&e>1160?4:e<1160&&e>850?3:e<850&&e>600?2:1,N.value=Math.round((document.body.clientWidth-30)/j.columnNumber)},re=k.debounce((()=>{if(H.loading)return;const e=Math.min.apply(null,j.colsHeightArr);q.value.scrollTop+B.value>e-20&&(console.log("触底"),Q.value=Q.value+1,I("load",{pageIndex:Q.value,pageSize:V.value}))}),1500),de=k.debounce((()=>{se(),j.loadedCount=0,j.beginIndex=0,j.images.forEach((e=>{e.minify_preview?(e._width=N.value,e._height=Math.round(N.value*(e._height/e._width)),j.loadedCount=j.loadedCount+1,j.imagesLen===j.loadedCount&&te()):(e._width=N.value,e._height=N.value,j.loadedCount=j.loadedCount+1,j.imagesLen===j.loadedCount&&te())}))}),800);return u((()=>{var e;ee.value=z.get("ip"),j.images=H.datas?H.datas:[],j.imagesLen=null==(e=H.datas)?void 0:e.length,se(),ie(),q.value=document.querySelector(".home-page"),q.value.addEventListener("scroll",re),window.addEventListener("resize",de)})),m((()=>{q.value.removeEventListener("scroll",re),window.removeEventListener("resize",de)})),(l,a)=>{const s=W,r=S,d=$,u=e,m=c("animate-css");return n(),o("div",D,[i("div",{ref_key:"wrapper",ref:T,class:"wrapper"},[i("div",G,[i("ul",J,[(n(!0),o(v,null,g(x(j).images,((e,l)=>(n(),o("li",{key:null==e?void 0:e.id,ref_for:!0,ref_key:"domRefs",ref:E,class:"image-item",style:h(`width:${N.value}px;height:${e._height}px;top:${e._top}px;left:${e._left}px;`)},[i("div",{class:"image-con",onMouseenter:e=>{return a=l,void(P.value=a);var a},onMouseleave:ae},[i("img",{src:(null==e?void 0:e.min_imgbb_url)?null==e?void 0:e.min_imgbb_url:null==e?void 0:e.minify_preview,alt:null==e?void 0:e.prompt,class:p({"high-image-blur":"high"===t.flur,"low-image-blur":"low"===t.flur})},null,10,R),P.value===l?(n(),o("div",U,[f(u,null,{default:_((()=>{var a;return[b((n(),o("div",X,[P.value===l?(n(),o("span",Y,[f(s)])):y("",!0),i("span",null,[f(r,{class:p({liked:null==(a=t.favoriteIds)?void 0:a.includes((null==e?void 0:e.id)+"")}),onClick:a=>(async(e,l)=>{I("favorite",e);const a=le.value[l].like;le.value[l].like=a+1})(null==e?void 0:e.id,l)},null,8,["class","onClick"]),f(d,{onClick:l=>{return a=e,void I("preview",{...a});var a}},null,8,["onClick"])])])),[[m,{direction:"modifySlideInDown"}]])]})),_:2},1024),f(u,null,{default:_((()=>[b((n(),o("div",Z,[i("p",null,w(null==e?void 0:e.name),1),i("p",null,w(null==e?void 0:e.prompt),1)])),[[m,{direction:"modifySlideInUp"}]])])),_:2},1024)])):y("",!0)],40,O)],4)))),128))])])],512),b(i("div",F,K,512),[[C,t.loading]])])}}}),[["__scopeId","data-v-2b877b94"]]);export{P as default};
