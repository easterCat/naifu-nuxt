import l from"./Icon.c7cf7b12.js";import e from"./AreaTitle.1e0e7e18.js";import{u as a}from"./index.c0d6e22f.js";import{u as s}from"./pinia.7ac5f2a7.js";import{u as t,a as n}from"./shop.8f25176c.js";import{_ as o}from"./document-copy.9ed563a4.js";import{_ as u}from"./delete.3a3a4f9c.js";import{_ as r}from"./opportunity.6a6909c9.js";import{e as m,a as i,f as d,F as c,G as p,W as v,a2 as b,H as g,U as f,u as y,L as _,I as h,Y as x,Z as k,_ as w,$ as j,i as V,a3 as C,a0 as S,a1 as E}from"./element-plus.3e7898c2.js";import{d as z}from"./dayjs.3bf4ac2a.js";import{_ as I}from"./entry.cf5e7fb4.js";import"./lodash.93025024.js";import"./store.e5acb8cd.js";/* empty css                                                                  */import"./uuid.d56aad75.js";const U=l=>(S("data-v-7509db7a"),l=l(),E(),l),N={class:"tranfer-con"},O={class:"button-con"},R=["value"],J=U((()=>v("div",{class:"flex justify-between w-full text-xs"},[v("span",null,"1张"),v("span",null,"2张"),v("span",null,"3张"),v("span",null,"4张"),v("span",null,"5张"),v("span",null,"6张"),v("span",null,"7张"),v("span",null,"8张"),v("span",null,"9张")],-1))),Y={key:0,class:"g-image m-t-20"},$=["src"],A={class:"title-side"},M={key:1,class:"history-con"},q={style:{"font-weight":"bold","margin-bottom":"4px"}},H={class:"history-button"},P=["onClick"],D=["onClick"],T=["onClick"],Z={key:2,class:"tags-con"},F=[U((()=>v("p",{class:"no-data"},"暂无记录",-1)))],G=I(m({__name:"generateImage",setup(m){const{NovalApi:S}=a(),{$store:E}=s(),{copy:I}=t(),{shop:U}=n(),G="prompt_history",L=i(""),W=i(""),B=i(1),K=i([]),Q=i(0),X=i([]),ll=i(!1),el=i([{label:"图片大小 512*768",value:"512*768"},{label:"图片大小 768*512",value:"768*512"},{label:"图片大小 512*512",value:"512*512"},{label:"图片大小 768*768",value:"768*768"},{label:"图片大小 768*1024",value:"768*1024"},{label:"图片大小 1024*768",value:"1024*768"}]),al=i("512*768"),sl=i([{label:"k_euler_ancestral",value:"k_euler_ancestral"},{label:"k_euler",value:"k_euler"},{label:"k_lms",value:"k_lms"},{label:"plms",value:"plms"},{label:"ddim",value:"ddim"}]),tl=i("k_euler_ancestral"),nl=i("lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry");d((()=>{cl(),W.value=sessionStorage.getItem("post_url")||""}));const ol=()=>{L.value=U.value,dl(L.value)},ul=()=>{pl(),K.value=[]},rl=()=>{L.value="",X.value=[]},ml=l=>{B.value=l.target.value||1},il=async()=>{if(ll.value)return;ll.value=!0;const l=al.value.split("*"),e=l[0],a=l[1],s=await S.generate({height:a,n_samples:B.value,prompt:L.value,sampler:tl.value,scale:12,seed:2081400182,steps:28,uc:nl.value,ucPreset:0,width:e,postUrl:W.value});ll.value=!1;const t=new RegExp("(?<=data:)[A-Za-z0-9\\/+=]+","g"),n=(s+"").match(t);X.value=null==n?void 0:n.map((l=>`data:image/png;base64,${l}`)),dl(L.value),sessionStorage.setItem("post_url",W.value)},dl=l=>{var e;let a=[];if(!l)return j.ElMessage({showClose:!0,message:"请输入prompt",type:"warning"});E.get(G)&&(a=null!=(e=JSON.parse(E.get(G)))?e:[]);if(!a.find((e=>e.prompt===l))){if(a&&a.length&&a.length>100)return j.ElMessage({showClose:!0,message:"数据超过100条",type:"warning"});a.includes(l)||a.unshift({prompt:l,time:z().format("YYYY年MM月DD日 HH时mm分ss秒")}),K.value=[...a],Q.value=K.value.length,E.set(G,JSON.stringify(K.value))}},cl=()=>{E.get(G)&&(K.value=JSON.parse(E.get(G)),Q.value=K.value.length)},pl=()=>{E.set(G,"")};return(a,s)=>{var t;const n=l,m=j.ElOption,i=j.ElSelect,d=j.ElCol,S=j.ElInput,z=j.ElRow,U=e,dl=r,cl=u,pl=o;return c(),p("div",N,[v("div",O,[v("button",{class:"btn btn-secondary btn-sm m-r-10",onClick:rl},[b(" 清空 "),g(n,{class:"m-l-6",name:"ant-design:delete-filled"})]),v("button",{class:"btn btn-sm btn-accent m-r-10",onClick:ol},[b(" 购物车导入 "),g(n,{class:"m-l-6",name:"clarity:shopping-cart-solid-badged"})]),v("button",{class:"btn btn-primary btn-sm m-r-10",onClick:il},[b(f(y(ll)?"图片生成中":"生成")+" ",1),y(ll)?(c(),_(n,{key:0,class:"m-l-6",name:"line-md:loading-twotone-loop"})):(c(),_(n,{key:1,class:"m-l-6",name:"entypo:brush"}))])]),g(z,{gutter:20},{default:h((()=>[g(d,{xs:24,sm:24,md:12,lg:8,xl:8},{default:h((()=>[g(i,{modelValue:y(al),"onUpdate:modelValue":s[0]||(s[0]=l=>V(al)?al.value=l:null),placeholder:"图片大小",size:"large",class:"w-full"},{default:h((()=>[(c(!0),p(x,null,k(y(el),(l=>(c(),_(m,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),g(d,{xs:24,sm:24,md:12,lg:8,xl:8},{default:h((()=>[g(i,{modelValue:y(tl),"onUpdate:modelValue":s[1]||(s[1]=l=>V(tl)?tl.value=l:null),placeholder:"采样器",size:"large",class:"w-full"},{default:h((()=>[(c(!0),p(x,null,k(y(sl),(l=>(c(),_(m,{key:l.value,label:l.label,value:l.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),g(d,{xs:24,sm:24,md:24,lg:24,xl:24},{default:h((()=>[g(S,{modelValue:y(W),"onUpdate:modelValue":s[2]||(s[2]=l=>V(W)?W.value=l:null),placeholder:"请输入url,例如: https://cube-joan-released-philips.trycloudflare.com/generate-stream",clearable:"",size:"large"},null,8,["modelValue"])])),_:1}),g(d,{xs:24,sm:24,md:12,lg:12,xl:12},{default:h((()=>[g(S,{modelValue:y(L),"onUpdate:modelValue":s[3]||(s[3]=l=>V(L)?L.value=l:null),type:"textarea",placeholder:"请输入正面Prompt",rows:8,clearable:"",autosize:{minRows:8,maxRows:8},"show-word-limit":"",maxlength:"3000"},null,8,["modelValue"])])),_:1}),g(d,{xs:24,sm:24,md:12,lg:12,xl:12},{default:h((()=>[g(S,{modelValue:y(nl),"onUpdate:modelValue":s[4]||(s[4]=l=>V(nl)?nl.value=l:null),type:"textarea",placeholder:"请输入负面Prompt",rows:8,clearable:"",autosize:{minRows:8,maxRows:8},"show-word-limit":"",maxlength:"3000"},null,8,["modelValue"])])),_:1}),g(d,{xs:24,sm:24,md:24,lg:24,xl:24},{default:h((()=>[v("input",{type:"range",min:"1",max:"9",value:y(B),class:"range range-xs",step:"1",onChange:ml},null,40,R),J])),_:1})])),_:1}),y(X)?(c(),p("div",Y,[v("ul",null,[(c(!0),p(x,null,k(y(X),((l,e)=>(c(),p("li",{key:e},[v("img",{src:l,alt:""},null,8,$)])))),128))])])):w("",!0),g(U,{title:"历史记录"},{titleSide:h((()=>[v("span",A,"总数:"+f(y(Q))+"条",1)])),_:1}),y(K)&&(null==(t=y(K))?void 0:t.length)?(c(),p("div",M,[v("div",{class:"button-con"},[v("button",{class:"btn btn-accent btn-sm",onClick:ul},"清空历史")]),(c(!0),p(x,null,k(y(K),((l,e)=>(c(),p("div",{key:e,class:"history-item"},[v("p",q,[0===e?(c(),_(dl,{key:0,style:{color:"#67c23a","font-size":"12px"}})):w("",!0),v("span",null,f(null==l?void 0:l.time),1)]),v("p",null,f(null==l?void 0:l.prompt),1),v("div",H,[v("button",{class:"btn btn-sm btn-secondary m-r-10",onClick:l=>(l=>{var e;const a=null!=(e=JSON.parse(E.get(G)))?e:[];a.splice(l,1),K.value=[...a],Q.value=0,E.set(G,JSON.stringify(K.value))})(e)},[b(" 删除 "),C(a.$slots,"icon",{},(()=>[g(cl,{class:"m-l-6"})]),!0)],8,P),v("button",{class:"btn btn-sm btn-accent m-r-10",onClick:e=>y(I)(null==l?void 0:l.prompt)},[b(" 复制 "),C(a.$slots,"icon",{},(()=>[g(pl,{class:"m-l-6"})]),!0)],8,D),v("button",{class:"btn btn-sm btn-primary",onClick:e=>{return a=null==l?void 0:l.prompt,void(L.value=a);var a}},[b(" 选择 "),g(n,{class:"m-l-6",name:"icon-park-solid:full-selection"})],8,T)])])))),128))])):(c(),p("div",Z,F))])}}}),[["__scopeId","data-v-7509db7a"]]);export{G as default};
