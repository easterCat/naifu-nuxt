import e from"./Icon.b50eae24.js";import l from"./AreaTitle.d2cca97e.js";import{u as a}from"./index.131f7cc9.js";import{u as s}from"./pinia.17670579.js";import{u as t,a as n,w as o}from"./shop.d3010ead.js";import{_ as u}from"./document-copy.d0e58c3c.js";import{_ as r}from"./delete.c5b0c1fb.js";import{_ as i}from"./opportunity.67839f21.js";import{e as m,a as p,f as d,a4 as c,G as v,H as g,Z as b,_ as f,J as h,W as _,u as w,N as y,L as x,$ as k,a0 as j,a1 as C,i as V,I as N,a5 as S,a6 as M}from"./element-plus.fe53e503.js";import{d as I}from"./dayjs.3bf4ac2a.js";import{u as $}from"./setting.64fb53b2.js";import{_ as U}from"./entry.0f1f4d34.js";import"./lodash.cb875ed5.js";import"./store.e5acb8cd.js";/* empty css                                                                  */import"./uuid.d56aad75.js";import"./vue3-clipboard-es.62b9b053.js";const z=e=>(S("data-v-8c46f7bf"),e=e(),M(),e),E={class:"tranfer-con"},A={class:"button-con"},J=["value"],O=z((()=>b("div",{class:"flex justify-between w-full text-xs"},[b("span",null,"1张"),b("span",null,"2张"),b("span",null,"3张"),b("span",null,"4张"),b("span",null,"5张"),b("span",null,"6张"),b("span",null,"7张"),b("span",null,"8张"),b("span",null,"9张")],-1))),R={key:0,class:"g-image m-t-20"},P=["src","onClick"],Y={class:"title-side"},q={key:1,class:"history-con"},D={style:{"font-weight":"bold","margin-bottom":"4px"}},G={class:"history-button"},H=["onClick"],T=["onClick"],Z=["onClick"],F={key:2,class:"tags-con"},L=[z((()=>b("p",{class:"no-data"},"暂无记录",-1)))],W=U(m({__name:"generateImage",setup(m){const S=$(),{NovalApi:M}=a(),{$store:U}=s(),{copy:z}=t(),{shop:W,setShop:B}=n(),K="prompt_history",Q=p(""),X=p(""),ee=p(""),le=p([]),ae=p(0),se=p([]),te=p(!1),ne=p([{label:"图片大小 512*768",value:"512*768"},{label:"图片大小 768*512",value:"768*512"},{label:"图片大小 512*512",value:"512*512"},{label:"图片大小 768*768",value:"768*768"},{label:"图片大小 768*1024",value:"768*1024"},{label:"图片大小 1024*768",value:"1024*768"}]),oe=p("512*768"),ue=p([{label:"k_euler_ancestral",value:"k_euler_ancestral"},{label:"k_euler",value:"k_euler"},{label:"k_lms",value:"k_lms"},{label:"plms",value:"plms"},{label:"ddim",value:"ddim"}]),re=p("k_euler_ancestral"),ie=p("lowres, bad anatomy, bad hands, text, error, missing fingers, extra digit, fewer digits, cropped, worst quality, low quality, normal quality, jpeg artifacts, signature, watermark, username, blurry");d((()=>{we(),me(),X.value=sessionStorage.getItem("post_url")||"",ee.value=sessionStorage.getItem("post_url_provide")||""}));const me=()=>{Q.value=W.value,Q.value&&_e(Q.value)},pe=e=>{B(e)},de=()=>{ye(),le.value=[]},ce=()=>{Q.value="",se.value=[]},ve=e=>{S.setDrawNumber(e.target.value||1)},ge=e=>{e&&(sessionStorage.setItem("post_url",e),sessionStorage.setItem("post_url_provide",e),ee.value=e,X.value=e)},be=()=>{X.value&&X.value.includes("www.naifuai.site")?fe():he()},fe=async()=>{if(te.value)return;te.value=!0;const e=oe.value.split("*"),l=e[0],a=e[1];try{if(1===S.drawNumber){const e=Math.floor(Math.random()*Math.pow(2,32)),s=await M.rrythGenerate({n_samples:S.drawNumber,sampler:re.value,postUrl:X.value,init_images:"",prompt:Q.value,seed:e,negative_prompt:ie.value,cfg_scale:12,width:l,height:a,denoising_strength:.6,steps:28});te.value=!1;const t=s.data.images;se.value=null==t?void 0:t.map((e=>`data:image/png;base64,${e}`))}else{const e=await Promise.all(Array.from({length:S.drawNumber}).map((e=>{const s=Math.floor(Math.random()*Math.pow(2,32));return M.rrythGenerate({n_samples:S.drawNumber,sampler:re.value,postUrl:X.value,init_images:"",prompt:Q.value,seed:s,negative_prompt:ie.value,cfg_scale:12,width:l,height:a,denoising_strength:.6,steps:28})})));te.value=!1;const s=e.map((e=>e.data.images[0]));se.value=null==s?void 0:s.map((e=>`data:image/png;base64,${e}`))}_e(Q.value),pe(Q.value),sessionStorage.setItem("post_url",X.value)}catch(s){te.value=!1}},he=async()=>{if(te.value)return;if(!X.value)return o("地址为空");te.value=!0;const e=oe.value.split("*"),l=e[0],a=e[1],s=Math.floor(Math.random()*Math.pow(2,32));X.value.includes("/generate-stream")||(X.value=`${X.value}/generate-stream`);try{const e=await M.generate({height:a,n_samples:S.drawNumber,prompt:Q.value,sampler:re.value,scale:12,seed:s,steps:28,uc:ie.value,ucPreset:0,width:l,postUrl:X.value});te.value=!1;const t=new RegExp("(?<=data:)[A-Za-z0-9\\/+=]+","g"),n=`${e}`.match(t);se.value=null==n?void 0:n.map((e=>`data:image/png;base64,${e}`)),_e(Q.value),pe(Q.value),sessionStorage.setItem("post_url",X.value)}catch(t){te.value=!1}},_e=e=>{var l;let a=[];if(!e)return c.ElMessage({showClose:!0,message:"请输入prompt",type:"warning"});U.get(K)&&(a=null!=(l=JSON.parse(U.get(K)))?l:[]);if(!a.find((l=>l.prompt===e))){if(a&&a.length&&a.length>100)return c.ElMessage({showClose:!0,message:"数据超过100条",type:"warning"});a.includes(e)||a.unshift({prompt:e,time:I().format("YYYY年MM月DD日 HH时mm分ss秒")}),le.value=[...a],ae.value=le.value.length,U.set(K,JSON.stringify(le.value))}},we=()=>{U.get(K)&&(le.value=JSON.parse(U.get(K)),ae.value=le.value.length)},ye=()=>{U.set(K,"")};return(a,t)=>{var n;const o=e,m=c.ElOption,p=c.ElSelect,d=c.ElCol,M=c.ElInput,I=c.ElRow,$=l,W=i,B=r,pe=u;return v(),g("div",E,[b("div",A,[b("button",{class:"btn btn-secondary btn-sm m-r-10",onClick:ce},[f(" 清空 "),h(o,{class:"m-l-6",name:"ant-design:delete-filled"})]),b("button",{class:"btn btn-sm btn-accent m-r-10",onClick:me},[f(" 购物车导入 "),h(o,{class:"m-l-6",name:"clarity:shopping-cart-solid-badged"})]),b("button",{class:"btn btn-primary btn-sm m-r-10",onClick:be},[f(_(w(te)?"图片生成中":"生成")+" ",1),w(te)?(v(),y(o,{key:0,class:"m-l-6",name:"line-md:loading-twotone-loop"})):(v(),y(o,{key:1,class:"m-l-6",name:"entypo:brush"}))])]),h(I,{gutter:20},{default:x((()=>[h(d,{xs:24,sm:24,md:12,lg:8,xl:8},{default:x((()=>[h(p,{modelValue:w(oe),"onUpdate:modelValue":t[0]||(t[0]=e=>V(oe)?oe.value=e:null),placeholder:"图片大小",size:"large",class:"w-full"},{default:x((()=>[(v(!0),g(k,null,j(w(ne),(e=>(v(),y(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(d,{xs:24,sm:24,md:12,lg:8,xl:8},{default:x((()=>[h(p,{modelValue:w(re),"onUpdate:modelValue":t[1]||(t[1]=e=>V(re)?re.value=e:null),placeholder:"采样器",size:"large",class:"w-full"},{default:x((()=>[(v(!0),g(k,null,j(w(ue),(e=>(v(),y(m,{key:e.value,label:e.label,value:e.value},null,8,["label","value"])))),128))])),_:1},8,["modelValue"])])),_:1}),h(d,{xs:24,sm:24,md:24,lg:24,xl:24},{default:x((()=>[h(M,{modelValue:w(X),"onUpdate:modelValue":t[3]||(t[3]=e=>V(X)?X.value=e:null),placeholder:"请输入url,例如: https://cube-joan-released-philips.trycloudflare.com/generate-stream",clearable:"",size:"large"},{prepend:x((()=>[h(p,{modelValue:w(ee),"onUpdate:modelValue":t[2]||(t[2]=e=>V(ee)?ee.value=e:null),placeholder:"选择接口",style:{width:"115px"},size:"large",onChange:ge},{default:x((()=>[h(m,{label:"FreeApi",value:"https://www.naifuai.site/api/draw/ai"}),h(m,{label:"Colab",value:"https://cube-joan-released-philips.trycloudflare.com/generate-stream"})])),_:1},8,["modelValue"])])),_:1},8,["modelValue"])])),_:1}),h(d,{xs:24,sm:24,md:12,lg:12,xl:12},{default:x((()=>[h(M,{modelValue:w(Q),"onUpdate:modelValue":t[4]||(t[4]=e=>V(Q)?Q.value=e:null),type:"textarea",placeholder:"请输入正面Prompt",rows:8,clearable:"",autosize:{minRows:8,maxRows:8},"show-word-limit":"",maxlength:"3000"},null,8,["modelValue"])])),_:1}),h(d,{xs:24,sm:24,md:12,lg:12,xl:12},{default:x((()=>[h(M,{modelValue:w(ie),"onUpdate:modelValue":t[5]||(t[5]=e=>V(ie)?ie.value=e:null),type:"textarea",placeholder:"请输入负面Prompt",rows:8,clearable:"",autosize:{minRows:8,maxRows:8},"show-word-limit":"",maxlength:"3000"},null,8,["modelValue"])])),_:1}),h(d,{xs:24,sm:24,md:24,lg:24,xl:24},{default:x((()=>[b("input",{type:"range",min:"1",max:"9",value:w(S).drawNumber,class:"range range-xs",step:"1",onChange:ve},null,40,J),O])),_:1})])),_:1}),w(se)?(v(),g("div",R,[b("ul",null,[(v(!0),g(k,null,j(w(se),((e,l)=>(v(),g("li",{key:l},[b("img",{src:e,alt:"",onClick:l=>((e="")=>{const{$viewerApi:l}=s();l({images:[e]})})(e)},null,8,P)])))),128))])])):C("",!0),h($,{title:"历史记录"},{titleSide:x((()=>[b("span",Y,"总数:"+_(w(ae))+"条",1)])),_:1}),w(le)&&(null==(n=w(le))?void 0:n.length)?(v(),g("div",q,[b("div",{class:"button-con"},[b("button",{class:"btn btn-accent btn-sm",onClick:de},"清空历史")]),(v(!0),g(k,null,j(w(le),((e,l)=>(v(),g("div",{key:l,class:"history-item"},[b("p",D,[0===l?(v(),y(W,{key:0,style:{color:"#67c23a","font-size":"12px"}})):C("",!0),b("span",null,_(null==e?void 0:e.time),1)]),b("p",null,_(null==e?void 0:e.prompt),1),b("div",G,[b("button",{class:"btn btn-sm btn-secondary m-r-10",onClick:e=>(e=>{var l;const a=null!=(l=JSON.parse(U.get(K)))?l:[];a.splice(e,1),le.value=[...a],ae.value=le.value.length,U.set(K,JSON.stringify(le.value))})(l)},[f(" 删除 "),N(a.$slots,"icon",{},(()=>[h(B,{class:"m-l-6"})]),!0)],8,H),b("button",{class:"btn btn-sm btn-accent m-r-10",onClick:l=>w(z)(null==e?void 0:e.prompt)},[f(" 复制 "),N(a.$slots,"icon",{},(()=>[h(pe,{class:"m-l-6"})]),!0)],8,T),b("button",{class:"btn btn-sm btn-primary",onClick:l=>{return a=null==e?void 0:e.prompt,void(Q.value=a);var a}},[f(" 选择 "),h(o,{class:"m-l-6",name:"icon-park-solid:full-selection"})],8,Z)])])))),128))])):(v(),g("div",F,L))])}}}),[["__scopeId","data-v-8c46f7bf"]]);export{W as default};
