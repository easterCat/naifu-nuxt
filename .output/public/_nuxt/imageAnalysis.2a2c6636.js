import a from"./Icon.fa57f76f.js";import e from"./AreaTitle.dc73a93c.js";import{u as l}from"./index.131f7cc9.js";import{h as s,u as t}from"./pinia.17670579.js";import{a as n,u as i,e as o}from"./shop.d3010ead.js";import{e as c,a as m,f as u,G as d,H as p,Z as r,_ as b,J as v,W as f,u as _,N as g,L as y,$ as k,a0 as j,a4 as C,i as h,a5 as x,a6 as A}from"./element-plus.fe53e503.js";import{_ as I}from"./upload-filled.e21dedde.js";import{_ as S}from"./entry.d71b1392.js";import"./lodash.cb875ed5.js";import"./dayjs.3bf4ac2a.js";import"./store.e5acb8cd.js";/* empty css                                                                  */import"./uuid.d56aad75.js";import"./vue3-clipboard-es.62b9b053.js";const w=a=>(x("data-v-0d85bdbb"),a=a(),A(),a),E={class:"tranfer-con"},z={class:"button-con"},$={class:"el-icon el-icon--upload"},D=w((()=>r("div",{class:"el-upload__text"},[b(" 拖动图片到当前区域 或 "),r("em",null,"点击上传")],-1))),L={class:"upload-image-list-item"},P=["onClick"],J=["src","onClick"],N={class:"m-l-6"},R=["checked"],T={class:"el-upload-list__item-actions"},U={class:"m-l-10"},B={class:"m-l-8"},F=w((()=>r("div",{class:"el-upload__tip"},"jpg/png文件格式",-1))),G=w((()=>r("span",{style:{"font-size":"12px"}},"(基于deepdanbooru解析)",-1))),H={class:"tags-con"},K={class:"badge m-l-8"},O=S(c({__name:"imageAnalysis",emits:["setPreview"],setup(c,{emit:x}){const A="prompt_history",{DanbooruApi:S}=l(),w=s(),{$store:O}=t(),{setShop:W}=n();i();const Z=m(`${w.public.FLASK_BASE_API}/danbooru/upload`),q=m([]),M=m(0),Q=m([]),V=m(""),X=m([]),Y=m(!1);u((()=>{ta()}));const aa=(a,e,l)=>{const{code:t,data:n}=a,i=s().public.IP_ADDRESS;if(200===t){const{file_name:a,file_path:e}=n,s=l.length;l[s-1].name=a,l[s-1].url=i+e,Q.value=l}},ea=async()=>{if(!V.value)return o("请选择需要解析的图片");if(Y.value)return;Y.value=!0;const a=await S.analysisImage({name:V.value});Y.value=!1;const{code:e,data:l}=a;if(200===e){const{tags:a}=l;X.value=a;const e=Q.value.findIndex((a=>a.name===V.value));Q.value[e].tags=a}},la=()=>{V.value="",Q.value=[],X.value=[]},sa=()=>{const a=X.value.map((a=>a.key)).join(", ");W(a)},ta=()=>{O.get(A)&&(q.value=JSON.parse(O.get(A)),M.value=q.value.length)},na=(a="")=>{const{$viewerApi:e}=t();e({images:[a]})};return(l,s)=>{const t=a,n=I,i=C.ElUpload,o=C.ElCol,c=C.ElRow,m=e;return d(),p("div",E,[r("div",z,[r("button",{class:"btn btn-secondary m-r-10 m-b-10",onClick:la},[b(" 清空 "),v(t,{class:"m-l-6",name:"ant-design:delete-filled"})]),r("button",{class:"btn btn-accent m-r-10 m-b-10",onClick:sa},[b(" 导出购物车 "),v(t,{class:"m-l-6",name:"clarity:shopping-cart-solid-badged"})]),r("button",{class:"btn btn-primary m-r-10 m-b-10",onClick:ea},[b(f(_(Y)?"图片解析中":"解析图片")+" ",1),_(Y)?(d(),g(t,{key:0,class:"m-l-6",name:"line-md:loading-twotone-loop"})):(d(),g(t,{key:1,class:"m-l-6",name:"mdi:comment-edit"}))])]),v(c,{gutter:20},{default:y((()=>[v(o,{xs:24,sm:24,md:24,lg:24,xl:24},{default:y((()=>[v(i,{"file-list":_(Q),"onUpdate:file-list":s[0]||(s[0]=a=>h(Q)?Q.value=a:null),class:"upload-demo",drag:"",action:_(Z),accept:"image/png, image/jpeg, image/jpg",multiple:"","list-type":"picture","on-success":aa},{file:y((({file:a})=>[r("div",L,[r("span",{onClick:e=>(a=>{V.value=a.name,X.value=a.tags||[]})(a)},[r("img",{class:"el-upload-list__item-thumbnail",src:a.url,alt:"",onClick:e=>na(a.url)},null,8,J),r("span",N,f(a.name),1),r("input",{class:"checkbox m-l-10",type:"checkbox",checked:_(V)===a.name},null,8,R)],8,P),r("span",T,[r("span",null,[v(t,{name:"material-symbols:image",size:"28",onClick:e=>{na(a.url)}},null,8,["onClick"])]),r("span",U,[v(t,{name:"material-symbols:content-copy",size:"28",onClick:e=>{na(a.url)}},null,8,["onClick"])]),r("span",B,[v(t,{name:"ic:baseline-delete",size:"28",onClick:e=>(a=>{console.log(a);const e=Q.value.findIndex((e=>e.name===a.name));e>=0&&Q.value.splice(e,1)})(a)},null,8,["onClick"])])])])])),tip:y((()=>[F])),default:y((()=>[r("i",$,[v(n)]),D])),_:1},8,["file-list","action"])])),_:1})])),_:1}),v(m,{title:"解析标签 "},{titleSide:y((()=>[G])),_:1}),r("div",H,[(d(!0),p(k,null,j(_(X),((a,e)=>{var l;return d(),p("button",{key:e,class:"btn btn-sm btn-secondary m-r-10 m-b-10"},[r("span",null,f(null==(l=a.key)?void 0:l.toLowerCase()),1),r("div",K,f(a.value),1)])})),128))])])}}}),[["__scopeId","data-v-0d85bdbb"]]);export{O as default};
