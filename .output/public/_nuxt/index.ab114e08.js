var t=Object.defineProperty,e=(e,s,a)=>(((e,s,a)=>{s in e?t(e,s,{enumerable:!0,configurable:!0,writable:!0,value:a}):e[s]=a})(e,"symbol"!=typeof s?s+"":s,a),a);import{a_ as s,aU as a,aW as n,an as r,a$ as o}from"./entry.867af431.js";const i=s({id:"index-store",state:()=>({userInfo:localStorage.getItem("user")?JSON.parse(localStorage.getItem("user")):{nickname:"",username:""},access_token:localStorage.getItem("access_token")?JSON.parse(localStorage.getItem("access_token")):"",refresh_token:localStorage.getItem("refresh_token")?JSON.parse(localStorage.getItem("refresh_token")):""}),getters:{nickname:t=>t.userInfo.nickname,username:t=>t.userInfo.nickname?t.userInfo.nickname:t.userInfo.username},actions:{setUserInfo(t){this.userInfo={...t},localStorage.setItem("user",JSON.stringify(this.userInfo))},setToken(t,e){this.access_token=t,this.refresh_token=e,localStorage.setItem("access_token",JSON.stringify(this.access_token)),localStorage.setItem("refresh_token",JSON.stringify(this.refresh_token))},clearUserInfo(){this.userInfo={nickname:"",username:""},localStorage.removeItem("user")},clearToken(){this.access_token="",this.refresh_token="",localStorage.removeItem("access_token"),localStorage.removeItem("refresh_token")},async refresh(){const{AuthApi:t}=b(),e=await t.refresh();if(200===e.code){const{access_token:t}=e.data;this.access_token=t,localStorage.setItem("access_token",JSON.stringify(t))}}}}),c=(t,e,s)=>{const r=a(),o=r.public.FLASK_BASE_API,c=r.public.API_DATA_FROM,l=i();let h="";return h="github"===c||"github"===s?t:o+t,new Promise((async(t,a)=>{try{const r={...e,key:n.v4()};l.access_token&&"github"!==s&&(h.includes("refresh")?r.headers={Authorization:`Bearer ${l.refresh_token}`}:r.headers={Authorization:`Bearer ${l.access_token}`});const o=await $fetch(h,r);o?20001===(null==o?void 0:o.code)?await l.refresh():t(o):a(`${h} => 数据获取失败`)}catch(r){console.error("$fetch出现错误 => ",r),a(r)}}))};class l{constructor(){e(this,"get",((t,e,s)=>c(t,{method:"get",params:e},s))),e(this,"post",((t,e,s)=>c(t,{method:"post",body:e},s))),e(this,"put",((t,e,s)=>c(t,{method:"put",body:e},s))),e(this,"delete",((t,e,s)=>c(t,{method:"delete",body:e},s)))}}const h=new class extends l{getEhtags(){return this.get("https://raw.githubusercontent.com/scooderic/exhentai-tags-chinese-translation/master/dist/ehtags-cn.json",{},"github")}};const u=new class extends l{getNameSpaceList(){return this.get("https://ehtt.fly.dev/database",{},"github")}getListByNameSpace(){return this.get("https://raw.githubusercontent.com/EhTagTranslation/Database/master/database/female.md",{},"github")}getAllJsonData(){return this.get("https://raw.githubusercontent.com/EhTagTranslation/DatabaseReleases/master/db.full.json",{},"github")}};const g=new class extends l{getList(t){return this.get("https://lexica.art/api/v1/search",t)}};const p=new class extends l{getList(t){return this.post("https://api.cerfai.com/open/get_full_categories",t,"github")}getTagsById(t){return this.post("https://api.cerfai.com/open/get_tags_by_category",t,"github")}searchTags(t){return this.post("https://api.cerfai.com/search_tags",t,"github")}};const m=new class extends l{translate(t){return this.post("/translate",t)}};const d=new class extends l{getTags(){return this.get("https://raw.githubusercontent.com/easterCat/nuxt-utils-assets/main/json/tags.json",{},"github")}};const _=new class extends l{async getLinks(){const t=a().public.API_DATA_FROM;if("github"===t){const t="https://raw.githubusercontent.com/easterCat/nuxt-utils-assets/main/json/links.json",e=await this.get(t);return{links:JSON.parse(e),total:null}}if("database"===t){const t=await this.get("/get_links",{pageIndex:1,pageSize:1e3}),{data:e}=r(t);return{links:e.list,total:e.total}}}async addLink(t){return await this.post("/add_link",t)}async updateLink(t){return await this.post("/update_link",t)}async deleteLink(t){return await this.post("/delete_link",t)}};const f=new class extends l{async getTemplates(t){const e=a().public.API_DATA_FROM;if("github"===e){const t="https://raw.githubusercontent.com/easterCat/nuxt-utils-assets/main/json/templates.json",e=await this.get(t);return{templates:JSON.parse(e),total:null}}if("database"===e){const e="/get_templates",s=await this.get(e,t),{data:a}=r(s);return{templates:a.list,total:a.total}}}async getTemplatesNoval(t){const e=await this.get("/get_templates_noval",t),{data:s}=r(e);return{templates:s.list,total:s.total}}async getTemplatesChitu(t){const e=await this.get("/get_templates_chitu",t),{data:s}=r(e);return{templates:s.list,total:s.total}}async setIp(){const t=(await this.get("/set_ip")).data.ip,{$store:e}=o();return e.set("ip",t),{ip:t}}async likeTemplateById(t){const e=await this.post("/like_template_by_id",t),{data:s}=r(e);return{like:s.like}}};const k={EhtagsApi:h,EhttApi:u,LexicaApi:g,GelbooruApi:p,ShopApi:m,DefaultTagsApi:d,LinkApi:_,TemplateApi:f,AuthApi:new class extends l{async register(t){return await this.post("/auth/registration",t)}async login(t){return await this.post("/auth/login",t)}async logout(){return await this.post("/auth/logout/access")}async refresh(){return await this.post("/auth/token/refresh")}}},b=()=>k;export{i as a,b as u};
