import{J as e,K as a,_ as l,I as t,aV as n,v as o,a8 as s,r as i,a_ as r,x as d,B as u,Y as c,aC as v,V as m,W as p,a5 as g,Z as h,a2 as _,a0 as f,X as y,a4 as x,a7 as w,U as b,aX as C,aY as L,an as k,aZ as A}from"./entry.f0c30f1b.js";import{l as M}from"./lodash.ea4d81e6.js";import"./AppHeader.844a27fd.js";import"./AppAnimate.vue_vue_type_script_setup_true_lang.52dd1724.js";import"./shop.59954df9.js";import"./element-plus.51c032f9.js";import"./plus.9e9d4eb4.js";import"./vuedraggable.b030dad4.js";import"./sortablejs.8210fcbe.js";import"./FixMenu.vue_vue_type_style_index_0_scoped_5afae692_lang.46760c02.js";/* empty css                                                                  */const j={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},z=[l("path",{fill:"currentColor",d:"M176 416a112 112 0 1 0 0 224a112 112 0 0 0 0-224m0 64a48 48 0 1 1 0 96a48 48 0 0 1 0-96zm336-64a112 112 0 1 1 0 224a112 112 0 0 1 0-224zm0 64a48 48 0 1 0 0 96a48 48 0 0 0 0-96zm336-64a112 112 0 1 1 0 224a112 112 0 0 1 0-224zm0 64a48 48 0 1 0 0 96a48 48 0 0 0 0-96z"},null,-1)];const I={name:"ep-more",render:function(l,t){return e(),a("svg",j,z)}},H={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},$=[l("path",{fill:"currentColor",d:"m512 747.84l228.16 119.936a6.4 6.4 0 0 0 9.28-6.72l-43.52-254.08l184.512-179.904a6.4 6.4 0 0 0-3.52-10.88l-255.104-37.12L517.76 147.904a6.4 6.4 0 0 0-11.52 0L392.192 379.072l-255.104 37.12a6.4 6.4 0 0 0-3.52 10.88L318.08 606.976l-43.584 254.08a6.4 6.4 0 0 0 9.28 6.72L512 747.84zM313.6 924.48a70.4 70.4 0 0 1-102.144-74.24l37.888-220.928L88.96 472.96A70.4 70.4 0 0 1 128 352.896l221.76-32.256l99.2-200.96a70.4 70.4 0 0 1 126.208 0l99.2 200.96l221.824 32.256a70.4 70.4 0 0 1 39.04 120.064L774.72 629.376l37.888 220.928a70.4 70.4 0 0 1-102.144 74.24L512 820.096l-198.4 104.32z"},null,-1)];const E={name:"ep-star",render:function(l,t){return e(),a("svg",H,$)}},N={viewBox:"0 0 1024 1024",width:"1.2em",height:"1.2em"},B=[l("path",{fill:"currentColor",d:"m795.904 750.72l124.992 124.928a32 32 0 0 1-45.248 45.248L750.656 795.904a416 416 0 1 1 45.248-45.248zM480 832a352 352 0 1 0 0-704a352 352 0 0 0 0 704z"},null,-1)];const T={name:"ep-search",render:function(l,t){return e(),a("svg",N,B)}},W=e=>(C("data-v-2ff37593"),e=e(),L(),e),q={class:"water-fall"},S={class:"image-con"},V={class:"image-list"},X=["onMouseenter"],Y=["date-src","alt"],Z={key:0,class:"item-wrapper"},F={class:"icon-con"},J={key:0},K={class:"text-con"},O={class:"spinner"},R=[W((()=>l("div",{class:"dot1"},null,-1))),W((()=>l("div",{class:"dot2"},null,-1)))],U=A(t({__name:"index",props:["datas","flur","loading","searchText"],emits:["load","preview","favorite"],setup(t,{emit:C}){const L=t,A=n();o((()=>L.datas),(e=>{"pc-home"===A.name&&e&&e.length>0&&(e.length<=50&&(j.beginIndex=0,j.loadedCount=0),j.images=e,j.imagesLen=e.length,te())})),o((()=>L.searchText),(e=>{"pc-home"===A.name&&e&&(U.value=1,D.value=50)}));const j=s({images:[],imagesLen:0,beginIndex:0,loadedCount:0,colsHeightArr:[],columnNumber:5}),z=i([]),H=i(0),$=i(0),N=i(null),B=i(window.document.body),W=i(null),U=i(1),D=i(50),{$store:G}=r(),P=i(""),Q=i([]),ee=()=>{W.value=null},ae=()=>{let e,a,l;0===j.beginIndex&&(j.colsHeightArr=[]);for(let t=j.beginIndex;t<j.imagesLen;++t){const n=j.images[t];if(!n)return;if(l=n._height||0,t<j.columnNumber)j.colsHeightArr.push(l),e=0,a=t*H.value+t%j.columnNumber;else{const t=Math.min.apply(null,j.colsHeightArr),n=j.colsHeightArr.indexOf(t);e=t,a=n*H.value,j.colsHeightArr[n]+=l}n._top=e,n._left=a}},le=()=>{console.log("预加载完毕 :>> "),ae(),Q.value=j.images,b((()=>{(()=>{N.value&&(N.value.style.height=`${Math.max.apply(null,j.colsHeightArr)+340}px`);const e=k(z.value);if(e){for(let a=j.beginIndex;a<j.imagesLen;++a){const l=e[a];if(!l)return;const t=l.children[0].children[0];t.src=t.getAttribute("date-src"),t.style.transition="all 0.5s ease-in-out",t.onload=()=>{t.style.opacity=1,t.style.transform="scale(1)"}}j.beginIndex=e.length}})()}))},te=()=>{$.value=document.body.clientHeight,j.images.forEach(((e,a)=>{if(!(a<j.loadedCount))if(e.minify_preview){const a=new Image;a.src=e.minify_preview,a.onload=a.onerror=l=>{e._width=H.value,e._height="load"===l.type?Math.round(H.value*(a.height/a.width)):a.width,"error"===l.type&&(e._error=!0),j.loadedCount=j.loadedCount+1,j.imagesLen===j.loadedCount&&le()}}else e._width=H.value,e._height=H.value,j.loadedCount=j.loadedCount+1,j.imagesLen===j.loadedCount&&le()}))},ne=()=>{console.log("页面宽高变化预加载完毕 :>> "),ae(),Q.value=j.images,b((()=>{(()=>{N.value&&(N.value.style.height=`${Math.max.apply(null,j.colsHeightArr)+340}px`);const e=k(z.value);e&&(j.beginIndex=e.length)})()}))},oe=()=>{const e=document.body.clientWidth;j.columnNumber=e>3500?10:e<3500&&e>2500?8:e<2500&&e>2e3?7:e<2e3&&e>1700?6:e<1700&&e>1380?5:e<1380&&e>1160?4:e<1160&&e>850?3:e<850&&e>600?2:1,H.value=Math.round((document.body.clientWidth-30)/j.columnNumber)},se=M.exports.debounce((()=>{if(L.loading)return;const e=Math.min.apply(null,j.colsHeightArr);B.value.scrollTop+$.value>e-20&&(console.log("触底"),U.value=U.value+1,C("load",{pageIndex:U.value,pageSize:D.value}))}),1500),ie=M.exports.debounce((()=>{oe(),j.loadedCount=0,j.beginIndex=0,j.images.forEach((e=>{e.minify_preview?(e._width=H.value,e._height=Math.round(H.value*(e._height/e._width)),j.loadedCount=j.loadedCount+1,j.imagesLen===j.loadedCount&&ne()):(e._width=H.value,e._height=H.value,j.loadedCount=j.loadedCount+1,j.imagesLen===j.loadedCount&&ne())}))}),800);return d((()=>{var e;P.value=G.get("ip"),j.images=L.datas?L.datas:[],j.imagesLen=null==(e=L.datas)?void 0:e.length,oe(),te(),B.value=document.querySelector(".home-page"),B.value.addEventListener("scroll",se),window.addEventListener("resize",ie)})),u((()=>{parent.removeEventListener("scroll",se),window.removeEventListener("resize",ie)})),(n,o)=>{const s=T,i=E,r=I;return e(),a("div",q,[l("div",{ref_key:"wrapper",ref:N,class:"wrapper"},[l("div",S,[l("ul",V,[(e(!0),a(c,null,v(t.datas,((n,o)=>(e(),a("li",{key:o,ref_for:!0,ref_key:"domRefs",ref:z,class:"image-item",style:g(`width:${H.value}px;height:${n._height}px;top:${n._top}px;left:${n._left}px;`)},[l("div",{class:"image-con",onMouseenter:e=>{return a=o,void(W.value=a);var a},onMouseleave:ee},[l("img",{"date-src":null==n?void 0:n.minify_preview,alt:null==n?void 0:n.prompt,class:h({"image-blur":!!t.flur})},null,10,Y),_(w,{name:"fade-q"},{default:f((()=>{var t;return[W.value===o?(e(),a("div",Z,[l("div",F,[W.value===o?(e(),a("span",J,[_(s)])):y("",!0),l("span",null,[_(i,{class:h({liked:null==(t=null==n?void 0:n.like_address)?void 0:t.includes(P.value)}),onClick:e=>(async(e,a)=>{C("favorite",e);const l=Q.value[a].like_address,t=Q.value[a].like;Q.value[a].like_address=l?`${l},${P.value}`:`${P.value}`,Q.value[a].like=t+1})(null==n?void 0:n.id,o)},null,8,["class","onClick"]),_(r,{onClick:e=>{return a=n,void C("preview",{...a});var a}},null,8,["onClick"])])]),l("div",K,[l("p",null,x(null==n?void 0:n.name),1),l("p",null,x(null==n?void 0:n.prompt),1)])])):y("",!0)]})),_:2},1024)],40,X)],4)))),128))])])],512),m(l("div",O,R,512),[[p,t.loading]])])}}}),[["__scopeId","data-v-2ff37593"]]);export{U as default};
